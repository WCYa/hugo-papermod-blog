[{"content":"äº‹å‰æº–å‚™ è¨­å®š Helm Repository helm repo add jenkinsci https://charts.jenkins.io helm repo update # å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æŸ¥è©¢ Jenkins repo å­˜åœ¨çš„ charts helm search repo jenkinsci å»ºç«‹ Namespace kubectl create namespace jenkins å»ºç«‹æŒä¹…æ€§å„²å­˜ PV å¦‚æœæ¸¬è©¦ç’°å¢ƒæ˜¯ä½¿ç”¨ minikubeï¼Œå¯ç›´æ¥åƒè€ƒ å®˜ç¶²ç¯„ä¾‹ å»ºç«‹ Local StorageClassï¼Œä½†éœ€è¦èƒ½æ¥å—ç•¶ç¯€é»ä¸å¯è¢«èª¿åº¦(å¦‚ CPU ä½¿ç”¨ç‡æ»¿è¼‰)é€ æˆæœå‹™ä¸­æ–·è·Ÿè³‡æ–™éºå¤±ç­‰ç­‰é¢¨éšª ä½¿ç”¨ Dynamic provisioner (ä¾‹å¦‚ï¼šRook)ï¼Œå‰‡ä¸ç”¨æ‰‹å‹•å»ºç«‹ PV é€™é‚Šä½¿ç”¨ Local StorageClass ç‚ºä¾‹ï¼Œé€™ç¨®æ–¹å¼æœ‰å€‹å¥½è™•ï¼Œå› ç‚ºè¨­å®š WaitForFirstConsumer æ™‚ï¼Œå¯ä»¥å»¶é² Volume Binding è®“ scheduler å¯ä»¥è€ƒæ…®æ‰€æœ‰ constrainsï¼Œå› æ­¤ç•¶ Local PV å»ºç«‹å¥½å¾Œï¼Œä¹‹å¾Œå»ºç«‹çš„ Pod ä½¿ç”¨ Local StorageClass æ™‚å°±æœƒè‡ªå‹•è¢«èª¿åº¦åˆ° PV çš„ç¯€é»ä¸Šï¼Œåƒè€ƒå®˜ç¶² Volume localã€‚\néœ€è¦å…ˆæ±ºå®š Local PV è¦å»ºç«‹åœ¨å“ªå€‹ç¯€é»ï¼Œé€™é‚Šé¸ç”¨æˆ‘çš„ç¯€é» k8s-1ã€‚\né¦–å…ˆåœ¨ç¯€é» k8s-1 å»ºç«‹ Local PV éœ€è¦çš„ç›®éŒ„\nmkdir -p /mnt/disks/ssd1 sudo chown 1000:1000 /mnt/disks/ssd1 ä»¥ä¸‹ç‚º StorageClassã€PV çš„ manifest æª”æ¡ˆï¼Œå‘½åç‚º jenkins-01-volume.yaml ï¼Œå¦‚æœç¯€é»åç¨±ä¸ä¸€æ¨£ï¼Œéœ€è¦èª¿æ•´ PV çš„ nodeAffinity çš„å€¼ï¼š\napiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: local-storage provisioner: kubernetes.io/no-provisioner # indicates that this StorageClass does not support automatic provisioning volumeBindingMode: WaitForFirstConsumer --- apiVersion: v1 kind: PersistentVolume metadata: name: jenkins-pv spec: capacity: storage: 20Gi volumeMode: Filesystem accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Retain storageClassName: local-storage local: path: /mnt/disks/ssd1 nodeAffinity: required: nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/hostname operator: In values: - k8s-1 å»ºç«‹ Resource Objectsï¼š\nkubectl apply -f jenkins-01-volume.yaml å»ºç«‹ Service Account æª”åï¼šjenkins-02-sa.yaml å®˜ç¶²é€£çµï¼šjenkins-02-sa.yaml --- apiVersion: v1 kind: ServiceAccount metadata: name: jenkins namespace: jenkins --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: annotations: rbac.authorization.kubernetes.io/autoupdate: \u0026#34;true\u0026#34; labels: kubernetes.io/bootstrapping: rbac-defaults name: jenkins rules: - apiGroups: - \u0026#39;*\u0026#39; resources: - statefulsets - services - replicationcontrollers - replicasets - podtemplates - podsecuritypolicies - pods - pods/log - pods/exec - podpreset - poddisruptionbudget - persistentvolumes - persistentvolumeclaims - jobs - endpoints - deployments - deployments/scale - daemonsets - cronjobs - configmaps - namespaces - events - secrets verbs: - create - get - watch - delete - list - patch - update - apiGroups: - \u0026#34;\u0026#34; resources: - nodes verbs: - get - list - watch - update --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: annotations: rbac.authorization.kubernetes.io/autoupdate: \u0026#34;true\u0026#34; labels: kubernetes.io/bootstrapping: rbac-defaults name: jenkins roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: jenkins subjects: - apiGroup: rbac.authorization.k8s.io kind: Group name: system:serviceaccounts:jenkins å»ºç«‹ Resource Objectsï¼š\nkubectl apply -f jenkins-02-sa.yaml å®‰è£ jenkins èª¿æ•´ Helm Chart åƒæ•¸ å¾å®˜ç¶²ä¸‹è¼‰ jenkins-values.yamlï¼Œæˆ–è€…ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åŒ¯å‡ºæˆæª”æ¡ˆï¼š\nhelm show values jenkinsci/jenkins éœ€è¦èª¿æ•´çš„éƒ¨ä»½å¦‚ä¸‹ï¼Œï¼š\ncontroller: serviceType: LoadBalancer å¦‚æœæ²’æœ‰ LoadBalancer å¯ä»¥ä½¿ç”¨ NodePortï¼Œä½†æˆ‘é€™é‚Šä½¿ç”¨ MetalLBï¼Œå®‰è£æ–¹å¼å¯åƒè€ƒå¦ä¸€ç¯‡æ–‡ç«  ã€Kubernetes å¤–éƒ¨å­˜å–ï¼šMetalLB è£¸æ©Ÿå®‰è£èˆ‡é€£ç·šæ¸¬è©¦ã€ servicePort: 80 å¦‚æœä½¿ç”¨ NodePort å°±è¦èª¿æ•´ç‚º 30000â€“32767 å…¶ä¸­ä¸€é …ï¼Œä¾‹å¦‚ 32000 persistence: storageClass: local-storage ä½¿ç”¨ä¸Šè¿°å»ºç«‹çš„ StorageClass serviceAccount: create: false name: jenkins ä½¿ç”¨ä¸Šè¿°å»ºç«‹çš„ ServiceAccount åç¨± rbac: create: false loadBalancerSourceRanges: 0.0.0.0/0 (# å¦‚æœä½¿ç”¨ MetalLB å°‡é€™è¡Œç§»é™¤ï¼Œå•é¡Œ) å®‰è£ helm install jenkins jenkinsci/jenkins -n jenkins -f jenkins-values.yaml å–çš„å¸³è™Ÿ admin çš„å¯†ç¢¼ï¼š\nkubectl get secret -n jenkins jenkins -o jsonpath=\u0026#34;{.data.jenkins-admin-password}\u0026#34; | base64 -d ; echo å¦‚æœä½¿ç”¨ LoadBalancer ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å–å¾— External IP\nkubectl get service jenkins -n jenkins -o jsonpath=\u0026#34;{.status.loadBalancer.ingress[0].ip}\u0026#34; ; echo ä½¿ç”¨ MetalLB æ™‚é‡åˆ°çš„å•é¡Œ ç•¶ LoadBalancer ä½¿ç”¨ MetalLB æ™‚ï¼Œå¦‚æœ jenkins chart çš„ value.yaml è¨­å®š controller.loadBalancerSourceRanges: [ 0.0.0.0/0 ] æ™‚ï¼Œç™¼ç¾ kube-proxy åœ¨èª¿æ•´ iptables æ™‚é€ æˆç„¡æ³•é€£ç·šã€‚\nä¾ç…§ä¸‹é¢çš„è³‡è¨Šï¼Œæµç¨‹å¦‚ä¸‹ï¼š\nå¯ä»¥çœ‹åˆ°åœ¨ chain KUBE-PROXY-FIREWALL å› ç‚ºç¬¦åˆäº† ipset KUBE-LOAD-BALANCER-FW å…§å®¹è€Œè·³è‡³ chain KUBE-SOURCE-RANGES-FIREWALL åœ¨ chain KUBE-SOURCE-RANGES-FIREWALL ç¬¬ä¸€æ¢è¦å‰‡å› ç‚º ipset KUBE-LOAD-BALANCER-SOURCE-CIDR ç‚ºç©ºæ‰€ä»¥ä¸ç¬¦åˆï¼Œç¹¼çºŒåœ¨åŒä¸€æ¢ chain çš„ä¸‹æ¢è¦å‰‡ åœ¨ä¸‹æ¢è¦å‰‡ä¸­ï¼Œipset KUBE-LOAD-BALANCER-SOURCE-IP å› ç‚ºåªæœ‰ä¸€æ¢ç´€éŒ„ 172.18.8.202,tcp:80,172.18.8.202ï¼Œä½†æ˜¯å› ç‚ºé€™æ¢çš„ç¬¬ä¸‰å€‹æ¬„ä½ src æ˜¯è¦ç­‰æ–¼ Service æœ¬èº«çš„ IP 172.18.8.202ï¼Œæ‰€ä»¥å¤–éƒ¨çš„ä¾†æº IP éƒ½ç„¡æ³•ç¬¦åˆï¼Œæ•…æ­¤è¦å‰‡ä¹Ÿä¸ç¬¦åˆï¼Œç¹¼çºŒåœ¨åŒä¸€æ¢ chain çš„ä¸‹æ¢è¦å‰‡ æœ€å¾Œä¸€æ¢è¦å‰‡æ˜¯ç›´æ¥ DROP æ‰å°åŒ…ï¼Œæ‰€ä»¥ç„¡æ³•é€£ç·šæˆåŠŸ kube-proxy çš„ chain å¦‚ä¸‹ï¼š\n-A KUBE-PROXY-FIREWALL -m comment --comment \u0026#34;Kubernetes service load balancer ip + port for load balancer with sourceRange\u0026#34; -m set --match-set KUBE-LOAD-BALANCER-FW dst,dst -j KUBE-SOURCE-RANGES-FIREWALL -A KUBE-SOURCE-RANGES-FIREWALL -m comment --comment \u0026#34;Kubernetes service load balancer ip + port + source cidr for packet filter purpose\u0026#34; -m set --match-set KUBE-LOAD-BALANCER-SOURCE-CIDR dst,dst,src -j RETURN -A KUBE-SOURCE-RANGES-FIREWALL -m comment --comment \u0026#34;Kubernetes service load balancer ip + port + source IP for packet filter purpose\u0026#34; -m set --match-set KUBE-LOAD-BALANCER-SOURCE-IP dst,dst,src -j RETURN -A KUBE-SOURCE-RANGES-FIREWALL -j DROP ipset å¦‚ä¸‹ï¼š\nName: KUBE-LOAD-BALANCER-FW Type: hash:ip,port Revision: 5 Header: family inet hashsize 1024 maxelem 65536 Size in memory: 256 References: 1 Number of entries: 1 Members: 172.18.8.202,tcp:80 Name: KUBE-LOAD-BALANCER-SOURCE-CIDR Type: hash:ip,port,net Revision: 7 Header: family inet hashsize 1024 maxelem 65536 Size in memory: 456 References: 1 Number of entries: 0 Members: Name: KUBE-LOAD-BALANCER-SOURCE-IP Type: hash:ip,port,ip Revision: 5 Header: family inet hashsize 1024 maxelem 65536 Size in memory: 280 References: 1 Number of entries: 1 Members: 172.18.8.202,tcp:80,172.18.8.202 å¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤å»ç´€éŒ„å°åŒ…æ˜¯å¦çœŸçš„é€²å…¥åˆ° DROP é‚£æ¢è¦å‰‡ï¼Œä½†æ˜¯å› ç‚º chain KUBE-SOURCE-RANGES-FIREWALL æ˜¯ç”± kube-proxy ç®¡ç†ï¼Œæ‰€ä»¥å®šæ™‚æœƒè¢«è¦†è“‹ï¼Œä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å¾Œè¦è¿…é€Ÿä½¿ç”¨ç€è¦½å™¨æˆ– curl æŒ‡ä»¤é€£ç·šæ¸¬è©¦ã€‚\nsudo iptables -I KUBE-SOURCE-RANGES-FIREWALL 3 -j LOG --log-prefix \u0026#34;KUBE_SOURCE_DROP_POINT: \u0026#34; --log-level 7 ; iptables-save | grep \u0026#39;KUBE-SOURCE-RANGES-FIREWALL\u0026#39; æŸ¥çœ‹ç´€éŒ„ï¼š\nsudo dmesg | grep \u0026#39;KUBE_SOURCE_DROP_POINT\u0026#39; # æˆ–è€… sudo journalctl -k | grep \u0026#39;KUBE_SOURCE_DROP_POINT\u0026#39; æ•´å€‹ Kubernetes cluster é‡å•Ÿå¾Œ jenkins ç„¡æ³•å•Ÿå‹• æˆ‘æŠŠ Kubernetes lab æ•´å€‹é—œæ‰ï¼Œéš”å¤©å†æ¬¡å•Ÿå‹•å¾Œç™¼ç¾ jenkins ç„¡æ³•æ­£å¸¸å•Ÿå‹•ï¼ŒæŸ¥çœ‹ events é¡¯ç¤º Back-off restarting failed container init in pod jenkins-0_jenkinsï¼Œæ‰€ä»¥é€éæŒ‡ä»¤ kubectl -n jenkins logs jenkins-0 -c init æŸ¥çœ‹ InitContainer init çš„è¨Šæ¯ï¼Œç™¼ç¾æœ€å¾Œå…©è¡Œ logs å¦‚ä¸‹ï¼š\ncopy plugins to shared volume cp: overwrite \u0026#39;/var/jenkins_plugins/antisamy-markup-formatter.jpi\u0026#39;? ... æŸ¥çœ‹ ConfigMap jenkins ï¼ˆapply_config.shï¼‰çš„æœ€å¾Œå¹¾è¡ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š\necho \u0026#34;copy plugins to shared volume\u0026#34; # Copy plugins to shared volume yes n | cp -i /usr/share/jenkins/ref/plugins/* /var/jenkins_plugins/; echo \u0026#34;finished initialization\u0026#34; æˆ‘èªç‚ºè·Ÿ yes n | cp -i é‚£è¡ŒæŒ‡ä»¤æœ‰é—œï¼Œèª¿æ•´æˆä½¿ç”¨ -n åƒæ•¸ï¼Œç„¶å¾Œé‡å•Ÿ Kubernetes cluster å¾Œ jenkins pod æ­£å¸¸å•Ÿå‹•\ncp -n /usr/share/jenkins/ref/plugins/* /var/jenkins_plugins/; ","permalink":"https://wcya.github.io/hugo-papermod-blog/posts/jenkins/","summary":"\u003ch2 id=\"äº‹å‰æº–å‚™\"\u003eäº‹å‰æº–å‚™\u003c/h2\u003e\n\u003ch3 id=\"è¨­å®š-helm-repository\"\u003eè¨­å®š Helm Repository\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm repo add jenkinsci https://charts.jenkins.io\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm repo update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æŸ¥è©¢ Jenkins repo å­˜åœ¨çš„ charts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm search repo jenkinsci\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"å»ºç«‹-namespace\"\u003eå»ºç«‹ Namespace\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl create namespace jenkins\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"å»ºç«‹æŒä¹…æ€§å„²å­˜-pv\"\u003eå»ºç«‹æŒä¹…æ€§å„²å­˜ PV\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eå¦‚æœæ¸¬è©¦ç’°å¢ƒæ˜¯ä½¿ç”¨ minikubeï¼Œå¯ç›´æ¥åƒè€ƒ \u003ca href=\"https://www.jenkins.io/doc/book/installing/kubernetes/#create-a-persistent-volume\"\u003eå®˜ç¶²ç¯„ä¾‹\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eå»ºç«‹ Local StorageClassï¼Œä½†éœ€è¦èƒ½æ¥å—ç•¶ç¯€é»ä¸å¯è¢«èª¿åº¦(å¦‚ CPU ä½¿ç”¨ç‡æ»¿è¼‰)é€ æˆæœå‹™ä¸­æ–·è·Ÿè³‡æ–™éºå¤±ç­‰ç­‰é¢¨éšª\u003c/li\u003e\n\u003cli\u003eä½¿ç”¨ Dynamic provisioner (ä¾‹å¦‚ï¼šRook)ï¼Œå‰‡ä¸ç”¨æ‰‹å‹•å»ºç«‹ PV\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eé€™é‚Šä½¿ç”¨ Local StorageClass ç‚ºä¾‹ï¼Œé€™ç¨®æ–¹å¼æœ‰å€‹å¥½è™•ï¼Œå› ç‚ºè¨­å®š \u003ccode\u003eWaitForFirstConsumer\u003c/code\u003e æ™‚ï¼Œå¯ä»¥å»¶é² Volume Binding è®“ scheduler å¯ä»¥è€ƒæ…®æ‰€æœ‰ constrainsï¼Œå› æ­¤ç•¶ Local PV å»ºç«‹å¥½å¾Œï¼Œä¹‹å¾Œå»ºç«‹çš„ Pod ä½¿ç”¨ Local StorageClass æ™‚å°±æœƒè‡ªå‹•è¢«èª¿åº¦åˆ° PV çš„ç¯€é»ä¸Šï¼Œåƒè€ƒå®˜ç¶² \u003ca href=\"https://kubernetes.io/docs/concepts/storage/volumes/#local\"\u003eVolume local\u003c/a\u003eã€‚\u003c/p\u003e\n\u003cp\u003eéœ€è¦å…ˆæ±ºå®š Local PV è¦å»ºç«‹åœ¨å“ªå€‹ç¯€é»ï¼Œé€™é‚Šé¸ç”¨æˆ‘çš„ç¯€é» \u003ccode\u003ek8s-1\u003c/code\u003eã€‚\u003c/p\u003e","title":"ğŸ¤µ Jenkinsï¼šå®‰è£ Jenkins åœ¨ Kubernetes"},{"content":"ç‚ºä»€éº¼æœ‰é€™å€‹ side project éå¾€å·¥ä½œçš„åœ˜éšŠéƒ½æ˜¯è·Ÿå¤–é¢åº—å®¶è¨‚åˆé¤ï¼Œä¸¦ä¸”æœ‰å„ç¨®é–€æª»ï¼šéœ€è¦æ»¿å¤šå°‘éŒ¢ or éœ€è¦å¹¾ä»½ä»¥ä¸Šæ‰èƒ½å¤–é€ã€‚é€™é€ æˆè² è²¬è¨‚é¤çš„åŒä»éœ€è¦å…ˆçµ±è¨ˆè³‡è¨Šå¾Œæ‰èƒ½å‘åº—å®¶è¨‚é¤ï¼Œä¸”éƒ½æ˜¯å¤§å®¶é€é Slack å‚³è¨Šæ¯çµ¦è² è²¬äººï¼Œä¸åªè€—è²»äººåŠ›å»çµ±è¨ˆä¸”å¶çˆ¾æœƒå‡ºéŒ¯é€ æˆé¤é»æ•¸é‡ä¸å°ã€‚\né€™å€‹ side project å°±æ˜¯ç‚ºäº†æ¸›å°‘é€™ä»¶äº‹æ‰€è€—è²»çš„äººåŠ›èˆ‡æ™‚é–“æˆæœ¬ï¼Œè®“æ”¶é›†ã€çµ±è¨ˆè¨‚å–®è³‡è¨Šçš„é€™ç¨®å·¥ä½œæ›´æœ‰æ•ˆç‡å’Œé™ä½å‡ºéŒ¯æ©Ÿç‡ã€‚\né€™å€‹ project æ˜¯ä½¿ç”¨ Bolt for Python å»ºç«‹ socket mode çš„ Slack appï¼Œé€™æ¨¡å¼æœ‰ä¸ç”¨å›ºå®š IPã€ä¸ç”¨åŸŸåã€ä¸ç”¨åˆæ³• SSL æ†‘è­‰ç­‰ç­‰å„ªå‹¢ã€‚\nDemo æ³¨æ„äº‹é … æ­¤å°ˆæ¡ˆæ˜¯ä½¿ç”¨ socket modeï¼Œæ²’è¾¦æ³•éƒ¨å±¬åˆ° Slack Marketplaceã€‚å»ºè­°åªåœ¨å…¬å¸å…§éƒ¨ã€ç§äºº workspace ä½¿ç”¨ã€‚ å¦‚æœåŒæ™‚é‹ä½œå…©å€‹ socket mode appï¼ŒåŸå‰‡ä¸Šæ‡‰è©²æœƒè¸¢å‡ºç¬¬ä¸€å€‹ appï¼Œä½†å› ç‚ºä½¿ç”¨ docker compose ä¸”è¨­å®š restart: always çš„é—œä¿‚ï¼Œå¯èƒ½å…©å€‹ app æœƒæŒçºŒé‡æ–°å•Ÿå‹•äº’ç›¸ç«¶çˆ­ï¼Œé€ æˆåŠŸèƒ½ç•°å¸¸ã€‚ é‡é ­å»ºç«‹ Slack app ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘å·²ç¶“è¨­å®šå¥½çš„ manifest æª”æ¡ˆå»å»ºç«‹ Slack appï¼Œè·³è‡³ Create your app from a manifest\nå»ºç«‹ä½ çš„ Slack appï¼šä½¿ç”¨ from scratch çš„æ–¹å¼ï¼Œå»ºç«‹ä¹‹å¾Œä½ å°‡é€²å…¥ä½ çš„ Slack app åŸºæœ¬è³‡è¨Šé é¢ã€‚æˆ–å¾ Your Apps é€²å…¥å‰›å‰›å»ºç«‹çš„ Slack appã€‚ å•Ÿç”¨ Socket Mode èˆ‡å»ºç«‹ App-level tokenï¼šé»é¸å´é‚Šæ¬„çš„ Socket Modeï¼Œå°‡ Enable Socket Mode çš„ Toggle Button é–‹å•Ÿï¼Œé€™å°‡å”åŠ©ä½ å»ºç«‹ App-level token å’Œéœ€è¦çš„ Scopeã€‚å»ºç«‹å®Œå¾Œå¯å°‡ App-level token å…ˆè¤‡è£½ä¸‹ä¾†ï¼Œæ­¤ Token æ‡‰è©²ç”± xapp- é–‹é ­ã€‚ è¨­å®š Slash Commandsï¼šé»é¸å´é‚Šæ¬„çš„ Slash Commandsï¼Œé»é¸ Create new Commandï¼ŒæŒ‡ä»¤åç¨±å¯éš¨æ„ï¼Œä¾‹å¦‚ï¼š Commandï¼š/order Short Descriptionï¼šé–‹å•Ÿåˆé¤è¨‚å–® èª¿æ•´ Bot Token Scopesï¼šé»é¸å´é‚Šæ¬„çš„ OAuth \u0026amp; Permissionsï¼Œæ»¾å‹•åˆ° Scopes éƒ¨ä»½çš„ Bot Token Scopes å€åŸŸï¼Œé»é¸ Add an OAuth Scope æ–°å¢ä»¥ä¸‹ scopesï¼š commandsï¼šä¸Šé¢é–‹å•Ÿ Slash Commands å°±æœƒæ–°å¢äº† chat:writeï¼šSlack app ç™¼é€è¨Šæ¯åˆ°é »é“ pins:writeï¼šé€é /order slash command é–‹å•Ÿçš„è¨Šæ¯æœƒè¢« pined å®‰è£ Slack App åˆ° Workspaceï¼šé»é¸å´é‚Šæ¬„çš„ Install Appï¼Œé»é¸ Install to {Your workspace}ã€‚å®‰è£å®Œå¾ŒåŒé é¢æœƒå‡ºç¾ Bot User OAuth Tokenï¼Œæ‡‰è©²ç‚º xoxb- é–‹é ­ï¼ŒåŒæ¨£è¤‡è£½èµ·ä¾†ã€‚ å°‡ Slack App åŠ å…¥æŸå€‹ Slack é »é“ï¼š æ‰“é–‹ä½ çš„ Slack å° Slack é »é“æŒ‰å³éµï¼Œé»é¸ View channel details åˆ‡åˆ° Integrations åˆ†é  æŒ‰ Add an Appï¼Œé¸æ“‡å‰›å‰›å»ºç«‹çš„ Slack app ä½¿ç”¨ manifest æª”æ¡ˆå»ºç«‹ Slack app å»ºç«‹ä½ çš„ Slack appï¼šä½¿ç”¨ from a manifest çš„æ–¹å¼ï¼Œè²¼ä¸Šä»¥ä¸‹ manifest json å»ºç«‹å¥½ Slack app å¾Œï¼Œä¸€æ¨£éœ€è¦å°‡å…¶å®‰è£åˆ° Workspace å’Œå¾ Slack é »é“åŠ å…¥ App { \u0026#34;display_information\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;slack-order\u0026#34; }, \u0026#34;features\u0026#34;: { \u0026#34;bot_user\u0026#34;: { \u0026#34;display_name\u0026#34;: \u0026#34;slack-order\u0026#34;, \u0026#34;always_online\u0026#34;: false }, \u0026#34;slash_commands\u0026#34;: [ { \u0026#34;command\u0026#34;: \u0026#34;/order\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;é–‹å•Ÿåˆé¤è¨‚å–®\u0026#34;, \u0026#34;should_escape\u0026#34;: false } ] }, \u0026#34;oauth_config\u0026#34;: { \u0026#34;scopes\u0026#34;: { \u0026#34;bot\u0026#34;: [ \u0026#34;chat:write\u0026#34;, \u0026#34;commands\u0026#34;, \u0026#34;pins:write\u0026#34; ] } }, \u0026#34;settings\u0026#34;: { \u0026#34;interactivity\u0026#34;: { \u0026#34;is_enabled\u0026#34;: true }, \u0026#34;org_deploy_enabled\u0026#34;: false, \u0026#34;socket_mode_enabled\u0026#34;: true, \u0026#34;token_rotation_enabled\u0026#34;: false } } é‹ä½œ Slack app é€é docker compose å»é‹è¡Œ appï¼Œæ‰€ä»¥ä¸»æ©Ÿéœ€è¦å…ˆå®‰è£ Docker Engine clone å°ˆæ¡ˆ git clone https://github.com/WCYa/slack-order.git å¾ç¯„ä¾‹è¤‡è£½ç’°å¢ƒè®Šæ•¸è¨­å®šæª” cd slack-order cp env_template .env ç·¨è¼¯ .envï¼Œæ–°å¢ä»¥ä¸‹å…©å€‹ tokens SLACK_APP_TOKEN=\u0026lsquo;xapp-\u0026hellip;\u0026rsquo; SLACK_BOT_TOKEN=\u0026lsquo;xoxb-\u0026hellip;\u0026rsquo; é‹è¡Œ docker compose up # or run container in background docker compose up -d ","permalink":"https://wcya.github.io/hugo-papermod-blog/posts/slack/slack-order/","summary":"\u003ch2 id=\"ç‚ºä»€éº¼æœ‰é€™å€‹-side-project\"\u003eç‚ºä»€éº¼æœ‰é€™å€‹ side project\u003c/h2\u003e\n\u003cp\u003eéå¾€å·¥ä½œçš„åœ˜éšŠéƒ½æ˜¯è·Ÿå¤–é¢åº—å®¶è¨‚åˆé¤ï¼Œä¸¦ä¸”æœ‰å„ç¨®é–€æª»ï¼šéœ€è¦æ»¿å¤šå°‘éŒ¢ or éœ€è¦å¹¾ä»½ä»¥ä¸Šæ‰èƒ½å¤–é€ã€‚é€™é€ æˆè² è²¬è¨‚é¤çš„åŒä»éœ€è¦å…ˆçµ±è¨ˆè³‡è¨Šå¾Œæ‰èƒ½å‘åº—å®¶è¨‚é¤ï¼Œä¸”éƒ½æ˜¯å¤§å®¶é€é Slack å‚³è¨Šæ¯çµ¦è² è²¬äººï¼Œä¸åªè€—è²»äººåŠ›å»çµ±è¨ˆä¸”å¶çˆ¾æœƒå‡ºéŒ¯é€ æˆé¤é»æ•¸é‡ä¸å°ã€‚\u003c/p\u003e\n\u003cp\u003eé€™å€‹ side project å°±æ˜¯ç‚ºäº†æ¸›å°‘é€™ä»¶äº‹æ‰€è€—è²»çš„äººåŠ›èˆ‡æ™‚é–“æˆæœ¬ï¼Œè®“æ”¶é›†ã€çµ±è¨ˆè¨‚å–®è³‡è¨Šçš„é€™ç¨®å·¥ä½œæ›´æœ‰æ•ˆç‡å’Œé™ä½å‡ºéŒ¯æ©Ÿç‡ã€‚\u003c/p\u003e\n\u003cp\u003eé€™å€‹ project æ˜¯ä½¿ç”¨ \u003ca href=\"https://github.com/slackapi/bolt-python\"\u003eBolt for Python\u003c/a\u003e å»ºç«‹ socket mode çš„ Slack appï¼Œé€™æ¨¡å¼æœ‰ä¸ç”¨å›ºå®š IPã€ä¸ç”¨åŸŸåã€ä¸ç”¨åˆæ³• SSL æ†‘è­‰ç­‰ç­‰å„ªå‹¢ã€‚\u003c/p\u003e\n\u003ch2 id=\"demo\"\u003eDemo\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"Demo\" loading=\"lazy\" src=\"/hugo-papermod-blog/posts/slack/slack-order/slack-order_demo.gif\"\u003e\u003c/p\u003e\n\u003ch2 id=\"æ³¨æ„äº‹é …\"\u003eæ³¨æ„äº‹é …\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eæ­¤å°ˆæ¡ˆæ˜¯ä½¿ç”¨ socket modeï¼Œæ²’è¾¦æ³•éƒ¨å±¬åˆ° Slack Marketplaceã€‚å»ºè­°åªåœ¨å…¬å¸å…§éƒ¨ã€ç§äºº workspace ä½¿ç”¨ã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœåŒæ™‚é‹ä½œå…©å€‹ socket mode appï¼ŒåŸå‰‡ä¸Šæ‡‰è©²æœƒè¸¢å‡ºç¬¬ä¸€å€‹ appï¼Œä½†å› ç‚ºä½¿ç”¨ docker compose ä¸”è¨­å®š \u003ccode\u003erestart: always\u003c/code\u003e çš„é—œä¿‚ï¼Œå¯èƒ½å…©å€‹ app æœƒæŒçºŒé‡æ–°å•Ÿå‹•äº’ç›¸ç«¶çˆ­ï¼Œé€ æˆåŠŸèƒ½ç•°å¸¸ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"é‡é ­å»ºç«‹-slack-app\"\u003eé‡é ­å»ºç«‹ Slack app\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘å·²ç¶“è¨­å®šå¥½çš„ manifest æª”æ¡ˆå»å»ºç«‹ Slack appï¼Œè·³è‡³ \u003ca href=\"/hugo-papermod-blog/posts/slack/slack-order/#%e4%bd%bf%e7%94%a8-manifest-%e6%aa%94%e6%a1%88%e5%bb%ba%e7%ab%8b-slack-app\"\u003eCreate your app from a manifest\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://api.slack.com/apps/new\"\u003eå»ºç«‹ä½ çš„ Slack app\u003c/a\u003eï¼šä½¿ç”¨ \u003ccode\u003efrom scratch\u003c/code\u003e çš„æ–¹å¼ï¼Œå»ºç«‹ä¹‹å¾Œä½ å°‡é€²å…¥ä½ çš„ Slack app åŸºæœ¬è³‡è¨Šé é¢ã€‚æˆ–å¾ \u003ca href=\"https://api.slack.com/apps\"\u003eYour Apps\u003c/a\u003e é€²å…¥å‰›å‰›å»ºç«‹çš„ Slack appã€‚\u003c/li\u003e\n\u003cli\u003eå•Ÿç”¨ Socket Mode èˆ‡å»ºç«‹ App-level tokenï¼šé»é¸å´é‚Šæ¬„çš„ \u003ccode\u003eSocket Mode\u003c/code\u003eï¼Œå°‡ \u003ccode\u003eEnable Socket Mode\u003c/code\u003e çš„ Toggle Button é–‹å•Ÿï¼Œé€™å°‡å”åŠ©ä½ å»ºç«‹ App-level token å’Œéœ€è¦çš„ Scopeã€‚å»ºç«‹å®Œå¾Œå¯å°‡ App-level token å…ˆè¤‡è£½ä¸‹ä¾†ï¼Œæ­¤ Token æ‡‰è©²ç”± \u003ccode\u003exapp-\u003c/code\u003e é–‹é ­ã€‚\u003c/li\u003e\n\u003cli\u003eè¨­å®š Slash Commandsï¼šé»é¸å´é‚Šæ¬„çš„ \u003ccode\u003eSlash Commands\u003c/code\u003eï¼Œé»é¸ \u003ccode\u003eCreate new Command\u003c/code\u003eï¼ŒæŒ‡ä»¤åç¨±å¯éš¨æ„ï¼Œä¾‹å¦‚ï¼š\n\u003cul\u003e\n\u003cli\u003eCommandï¼š\u003ccode\u003e/order\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eShort Descriptionï¼š\u003ccode\u003eé–‹å•Ÿåˆé¤è¨‚å–®\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eèª¿æ•´ Bot Token Scopesï¼šé»é¸å´é‚Šæ¬„çš„ \u003ccode\u003eOAuth \u0026amp; Permissions\u003c/code\u003eï¼Œæ»¾å‹•åˆ° Scopes éƒ¨ä»½çš„ \u003ccode\u003eBot Token Scopes\u003c/code\u003e å€åŸŸï¼Œé»é¸ \u003ccode\u003eAdd an OAuth Scope\u003c/code\u003e æ–°å¢ä»¥ä¸‹ scopesï¼š\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ecommands\u003c/code\u003eï¼šä¸Šé¢é–‹å•Ÿ Slash Commands å°±æœƒæ–°å¢äº†\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003echat:write\u003c/code\u003eï¼šSlack app ç™¼é€è¨Šæ¯åˆ°é »é“\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epins:write\u003c/code\u003eï¼šé€é \u003ccode\u003e/order\u003c/code\u003e slash command é–‹å•Ÿçš„è¨Šæ¯æœƒè¢« pined\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eå®‰è£ Slack App åˆ° Workspaceï¼šé»é¸å´é‚Šæ¬„çš„ \u003ccode\u003eInstall App\u003c/code\u003eï¼Œé»é¸ \u003ccode\u003eInstall to {Your workspace}\u003c/code\u003eã€‚å®‰è£å®Œå¾ŒåŒé é¢æœƒå‡ºç¾ Bot User OAuth Tokenï¼Œæ‡‰è©²ç‚º \u003ccode\u003exoxb-\u003c/code\u003e é–‹é ­ï¼ŒåŒæ¨£è¤‡è£½èµ·ä¾†ã€‚\u003c/li\u003e\n\u003cli\u003eå°‡ Slack App åŠ å…¥æŸå€‹ Slack é »é“ï¼š\n\u003col\u003e\n\u003cli\u003eæ‰“é–‹ä½ çš„ Slack\u003c/li\u003e\n\u003cli\u003eå° Slack é »é“æŒ‰å³éµï¼Œé»é¸ \u003ccode\u003eView channel details\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eåˆ‡åˆ° \u003ccode\u003eIntegrations\u003c/code\u003e åˆ†é \u003c/li\u003e\n\u003cli\u003eæŒ‰ \u003ccode\u003eAdd an App\u003c/code\u003eï¼Œé¸æ“‡å‰›å‰›å»ºç«‹çš„ Slack app\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"ä½¿ç”¨-manifest-æª”æ¡ˆå»ºç«‹-slack-app\"\u003eä½¿ç”¨ manifest æª”æ¡ˆå»ºç«‹ Slack app\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://api.slack.com/apps/new\"\u003eå»ºç«‹ä½ çš„ Slack app\u003c/a\u003eï¼šä½¿ç”¨ \u003ccode\u003efrom a manifest\u003c/code\u003e çš„æ–¹å¼ï¼Œè²¼ä¸Šä»¥ä¸‹ manifest json\u003c/li\u003e\n\u003cli\u003eå»ºç«‹å¥½ Slack app å¾Œï¼Œä¸€æ¨£éœ€è¦å°‡å…¶å®‰è£åˆ° Workspace å’Œå¾ Slack é »é“åŠ å…¥ App\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026#34;display_information\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;slack-order\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026#34;features\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026#34;bot_user\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nt\"\u003e\u0026#34;display_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;slack-order\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nt\"\u003e\u0026#34;always_online\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026#34;slash_commands\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nt\"\u003e\u0026#34;command\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/order\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nt\"\u003e\u0026#34;description\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;é–‹å•Ÿåˆé¤è¨‚å–®\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nt\"\u003e\u0026#34;should_escape\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026#34;oauth_config\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026#34;scopes\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nt\"\u003e\u0026#34;bot\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"s2\"\u003e\u0026#34;chat:write\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"s2\"\u003e\u0026#34;commands\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"s2\"\u003e\u0026#34;pins:write\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026#34;settings\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026#34;interactivity\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nt\"\u003e\u0026#34;is_enabled\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026#34;org_deploy_enabled\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026#34;socket_mode_enabled\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026#34;token_rotation_enabled\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"é‹ä½œ-slack-app\"\u003eé‹ä½œ Slack app\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eé€é docker compose å»é‹è¡Œ appï¼Œæ‰€ä»¥ä¸»æ©Ÿéœ€è¦å…ˆå®‰è£ Docker Engine\u003c/li\u003e\n\u003cli\u003eclone å°ˆæ¡ˆ\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/WCYa/slack-order.git\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"3\"\u003e\n\u003cli\u003eå¾ç¯„ä¾‹è¤‡è£½ç’°å¢ƒè®Šæ•¸è¨­å®šæª”\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e slack-order\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp env_template .env\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"4\"\u003e\n\u003cli\u003eç·¨è¼¯ \u003ccode\u003e.env\u003c/code\u003eï¼Œæ–°å¢ä»¥ä¸‹å…©å€‹ tokens\n\u003cul\u003e\n\u003cli\u003eSLACK_APP_TOKEN=\u0026lsquo;xapp-\u0026hellip;\u0026rsquo;\u003c/li\u003e\n\u003cli\u003eSLACK_BOT_TOKEN=\u0026lsquo;xoxb-\u0026hellip;\u0026rsquo;\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eé‹è¡Œ\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker compose up\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# or run container in background\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker compose up -d\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"ğŸ¤– Slack æ©Ÿå™¨äººï¼šè¨‚ä¾¿ç•¶æ©Ÿå™¨äºº"},{"content":"ç›®çš„ ä¸€èˆ¬æƒ…æ³ä¸‹è¦è®“å¤–éƒ¨ä½¿ç”¨è€…ä½¿ç”¨ Kubernetes çš„æœå‹™æ™‚ï¼Œéœ€è¦é€é External Load Balancers å¦‚ Cloud Provider (GCPã€AWSã€Azure\u0026hellip;)ï¼Œä½†åœ¨ä½¿ç”¨ bare metal Kubernetes clusters æ™‚ï¼ŒKubernetes æ²’æœ‰æä¾›åŸç”Ÿçš„é€™ç¨® Network Load Balancersï¼Œå¦‚æœè¦è®“å¤–éƒ¨ä½¿ç”¨è€…èƒ½é€£ç·šåˆ° bare metal cluster å…§éƒ¨çš„æœå‹™æ™‚ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ NodePort å’Œ ExternalIPs serviceï¼Œä½†é€™å…©ç¨®åœ¨ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨éƒ½æœ‰è‘—ç¼ºé»ã€‚\nMetalLB çš„ç›®çš„å°±æ˜¯èˆ‡æ¨™æº–ç¶²è·¯è¨­å‚™åšæ•´åˆï¼Œä½¿ç”¨æ¨™æº–çš„è·¯ç”±å”å®šä½¿åœ¨ bare-metal clusters å…§çš„ å°å¤–éƒ¨çš„æœå‹™ å¯ä»¥æ­£å¸¸é‹ä½œã€‚\nMetalLB æä¾›å…©ç¨®æ¨¡å¼ï¼šBGP mode å’Œ Layer 2 modeï¼ŒBGP mode æ‰èƒ½å¯¦ç¾çœŸæ­£çš„è·¨å¤šç¯€é»å‡è¡¡è² è¼‰ï¼Œä½†å› ç‚ºæˆ‘åªæ˜¯æ¸¬è©¦ç”¨é€”æ‰€ä»¥æ¡ç”¨ Layer 2 modeã€‚\nMetalLB åœ¨åšä»€éº¼ MetalLB æœƒåŒæ™‚ä½œåˆ°å…©å€‹åŠŸèƒ½å»æä¾›æ­¤æœå‹™ï¼šIP ä½å€åˆ†é…ã€å‘å¤–éƒ¨å®£å‘Š IP æ˜¯å­˜åœ¨æ–¼é€™å€‹ clusterã€‚\nIP ä½å€åˆ†é…ï¼šä½ éœ€è¦æä¾› IP Pools çµ¦ MetalLBï¼Œå…¶é¤˜çš„äº‹ä¾‹å¦‚åˆ†é…ã€å–æ¶ˆåˆ†é…ã€è¿½è¹¤éƒ½ç”± MetalLB è™•ç†ã€‚Private/Public çš„ IPV4/IPV6 ä½ è¦ç¨ç«‹æä¾›æˆ–æ˜¯ä¸€èµ·æä¾›éƒ½å¯ä»¥ï¼Œå–æ±ºæ–¼ä½ çš„ç’°å¢ƒå’Œç§Ÿç”¨çš„ IPs å‘å¤–éƒ¨å®£å‘Š IPï¼šå‘ cluster æ‰€åœ¨çš„ç¶²è·¯å®£å‘Šï¼Œé€™å€‹ IP å­˜åœ¨æˆ‘é€™å€‹ clusterï¼Œå®£å‘Šæ–¹å¼å–æ±ºæ–¼æ‰€ä½¿ç”¨çš„æ¨¡å¼ç‚ºä½•ï¼šARPã€NDPã€or BGP é—œæ–¼ Layer 2 æ¨¡å¼ åœ¨ Layer 2 æ¨¡å¼ä¸‹ï¼Œæ˜¯ä¸€å€‹ç¯€é»è² è²¬å‘æœ¬åœ°ç¶²è·¯å®£å‘ŠæŸå€‹ Service IPï¼Œæ•…æ‰€æœ‰æµåˆ°æ­¤ Service IP çš„æµé‡éƒ½å…ˆç¶“éé€™å°ç¯€é»ï¼Œä¹‹å¾Œæ‰ç”± kube-proxy å»åˆ†æ•£æµé‡åˆ°æ­¤ Service çš„æ‰€æœ‰ Podsã€‚æ•… Layer 2 æ¨¡å¼æœªå¯¦ç¾çœŸæ­£çš„ç¶²è·¯è² è¼‰å¹³è¡¡ï¼Œè€Œæ˜¯å¯¦ç¾æ•…éšœè½‰ç§»çš„åŠŸèƒ½ï¼Œæ•…éšœè½‰ç§»çš„åµæ¸¬æ˜¯ä½¿ç”¨ memberlist å¯¦ç¾ã€‚\né‚£æ˜¯èª°è² è²¬å»åšå®£å‘Šï¼Ÿ\nåªæœ‰ä¸€å€‹ç¯€é»å»å®£å‘ŠæŸå€‹ IP æ˜¯å®ƒè² è²¬ï¼Œæ•…éœ€è¦ç‚ºæ­¤ IP é¸å‡ºèª°æ˜¯å…¶ Leaderï¼Œç…§å®˜ç¶²çš„èªªæ³•æ­¤é¸èˆ‰æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œå·¥ä½œåŸç†å¦‚ä¸‹ï¼š\næ¯å€‹ speakers æ”¶é›†ä¸€å€‹å¯èƒ½ç‚ºæŸ IP çš„å®£å‘Šè€…çš„æ¸…å–®ï¼Œæœƒè€ƒæ…®å¹¾å€‹å› ç´ ï¼šactive çš„ speakersã€external traffic policyã€active çš„ endpointsã€node selectors ç­‰ç­‰ æ¯å€‹ speakers åšç›¸åŒçš„é‹ç®—ï¼šä½¿ç”¨ node+VIP å…ƒç´ ç®—å‡ºä¸€å€‹æ’åºçš„å“ˆå¸Œè¡¨ï¼Œä¸¦ä¸” Service IP ç”±æ­¤å“ˆå¸Œè¡¨é †åºç¬¬ä¸€å€‹çš„ item æ‰€æè¿°çš„ç¯€é» (speaker) å»è² è²¬å®£å‘Š Layer 2 æ¨¡å¼çš„é™åˆ¶\nä¸»è¦æœ‰é‡åˆ°å…©å€‹é™åˆ¶ï¼šå–®ç¯€é»é »å¯¬ç“¶é ¸ã€æ•…éšœç§»è½‰å¯èƒ½å»¶é²ã€‚\né »å¯¬é™åˆ¶ï¼š é›–ç„¶ Layer 2 æ¨¡å¼é€éé›œæ¹Šé‹ç®—å¯å°‡ä¸åŒ Service IP åˆ†æ•£çµ¦ä¸åŒç¯€é»ï¼Œå¯¦ç¾ Service å±¤ç´šçš„è² è¼‰å‡è¡¡ï¼Œä½†å°æ–¼å–®ä¸€ Service (ç‰¹åˆ¥æ˜¯èšåˆå¤§æµé‡çš„ Ingress Controller å’Œ Gateway API)ï¼Œå…¶æ‰€æœ‰æµå…¥æµé‡ä»å—é™æ–¼å–®ä¸€ç¯€é»çš„é »å¯¬èˆ‡è™•ç†èƒ½åŠ›ã€‚ æ•…éšœç§»è½‰å»¶é²ï¼š MetalLB é€éç™¼é€ Gratuitous ARP ä¾†å®£å‘Š IP çš„æ–° MAC Addressã€‚é›–ç„¶ç¾ä»£è¨­å‚™å¤šèƒ½å¿«é€Ÿæ›´æ–°ï¼Œä½†éƒ¨ä»½ä¸Šå±¤äº¤æ›å™¨æˆ–è·¯ç”±å™¨çš„ ARP å¿«å»ç­–ç•¥å¯èƒ½è¼ƒç‚ºä¿å®ˆ (æˆ–å¿½ç•¥GARP)ï¼Œå°è‡´åœ¨ ARP Table æ›´æ–°å‰ï¼Œæµé‡ä»è¢«é€å¾€æ•…éšœç¯€é»ï¼Œé€ æˆæ•¸ç§’è‡³æ•¸åˆ†é˜çš„é€£ç·šä¸­æ–·ã€‚ å®‰è£æ–¹å¼ æº–å‚™ é€™é‚Šæˆ‘ä½¿ç”¨ kube-proxy æ˜¯å•Ÿç”¨ IPVS modeï¼Œå®˜ç¶²æåˆ°å¿…é ˆå•Ÿç”¨ strict ARP modeï¼š\n# æŸ¥çœ‹æ­¤æŒ‡ä»¤æœƒæ›´æ”¹ä»€éº¼ï¼Œå¦‚æœæœ‰æ›´å‹•å°±æœƒå›å‚³é 0 å€¼ kubectl get configmap kube-proxy -n kube-system -o yaml | \\ sed -e \u0026#34;s/strictARP: false/strictARP: true/\u0026#34; | \\ kubectl diff -f - -n kube-system # å¯¦éš›å»æ›´æ–°ç•°å‹•ï¼Œå¦‚æœéŒ¯èª¤æœƒå›å‚³é 0 å€¼ kubectl get configmap kube-proxy -n kube-system -o yaml | \\ sed -e \u0026#34;s/strictARP: false/strictARP: true/\u0026#34; | \\ kubectl apply -f - -n kube-system é€é Helm å®‰è£ metallb helm repo add metallb https://metallb.github.io/metallb helm install metallb metallb/metallb --namespace metallb-system --create-namespace å®‰è£ MetalLB åˆ° cluster å¾Œï¼ŒåŒ…å«ä»¥ä¸‹ componentsï¼š\nmetallb-system/controller deployment. é€™æ˜¯ä¸€å€‹ cluster-wide çš„ Controllerï¼Œè™•ç† IP Address çš„åˆ†é…ã€‚ metallb-system/speaker daemonset. é€™å€‹å…ƒä»¶è² è²¬ä¾ç…§ä½ é¸æ“‡çš„æ¨¡å¼å»éµå¾ª protocol(s)ï¼Œè®“æœå‹™å¯ä»¥è¢«é€£ç·šã€‚ controller å’Œ speaker ä½¿ç”¨çš„ Service accountsï¼Œé‚„æœ‰è®“é€™äº› components æ­£å¸¸é‹ä½œçš„ RBAC æ¬Šé™ã€‚ æ­¤æ™‚ MetalLB ä»ç„¶æ˜¯é–’ç½®ç‹€æ…‹ï¼Œç›´åˆ°è¨­å®šäº†å°æ‡‰çš„ CRs (Custom Resources)ã€‚\nè¨­å®š CRs åº•ä¸‹ç‚ºç¯„ä¾‹ manifest æª”æ¡ˆï¼Œå‘½åç‚º metallb-l2-config.yamlã€‚å› ç‚ºæˆ‘çš„ç’°å¢ƒæ˜¯é€é KubeSpray çš„ Vagrantfile å»ºç«‹çš„ï¼Œæ‰€ä»¥ IPAddressPool å°±é¸ç”¨ 172.18.8.0/24 ç¶²æ®µã€‚\napiVersion: metallb.io/v1beta1 kind: IPAddressPool metadata: name: first-pool namespace: metallb-system spec: addresses: - 172.18.8.201-172.18.8.205 --- apiVersion: metallb.io/v1beta1 kind: L2Advertisement metadata: name: first-ad namespace: metallb-system spec: ipAddressPools: - first-pool å»ºç«‹ Resource Objectsï¼š\nkubectl apply -f metallb-l2-config.yaml è¨­å®šæ¸¬è©¦ç¶²é  æª”æ¡ˆåç¨± metallb-test.yaml\napiVersion: apps/v1 kind: Deployment metadata: name: nginx-test-deployment labels: app: nginx-test spec: replicas: 1 selector: matchLabels: app: nginx-test template: metadata: labels: app: nginx-test spec: containers: - name: nginx image: nginx:alpine ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: nginx-test-service # å¦‚æœéœ€è¦æŒ‡å®šå–å¾— IPAddressPool ç¯„åœå…§çš„ç‰¹å®š IPï¼ŒåŠ ä¸Šä»¥ä¸‹ annotations # annotations: # metallb.io/loadBalancerIPs: 172.18.8.203 spec: selector: app: nginx-test ports: - protocol: TCP port: 80 # å¤–éƒ¨é€£ç·šç”¨çš„ Port targetPort: 80 # Pod å…§éƒ¨çš„ Port type: LoadBalancer # é¡å‹è¨­å®šç‚º LoadBalancerï¼ŒMetalLB æœƒè‡ªå‹•ç‚ºé€™å€‹ Service åˆ†é… IP å»ºç«‹ Resource Objectsï¼š\nkubectl apply -f metallb-test.yaml æª¢æŸ¥ Service ç‹€æ…‹å’Œç¢ºèªé€£ç·šï¼š\nkubectl get svc nginx-test-service é€éä¸Šè¿°æŒ‡ä»¤å–å¾— EXTERNAL-IP å¾Œï¼Œæ‰“é–‹ç€è¦½å™¨è¼¸å…¥ http://{EXTERNAL-IP} æ‡‰è©²èƒ½çœ‹åˆ° \u0026ldquo;Welcome to nginx!\u0026rdquo; çš„ç•«é¢\nç§»é™¤æ¸¬è©¦ç¶²é \nkubectl delete -f metallb-test.yaml ","permalink":"https://wcya.github.io/hugo-papermod-blog/posts/kubernetes/metallb/","summary":"\u003ch2 id=\"ç›®çš„\"\u003eç›®çš„\u003c/h2\u003e\n\u003cp\u003eä¸€èˆ¬æƒ…æ³ä¸‹è¦è®“å¤–éƒ¨ä½¿ç”¨è€…ä½¿ç”¨ Kubernetes çš„æœå‹™æ™‚ï¼Œéœ€è¦é€é External Load Balancers å¦‚ Cloud Provider (GCPã€AWSã€Azure\u0026hellip;)ï¼Œä½†åœ¨ä½¿ç”¨ bare metal Kubernetes clusters æ™‚ï¼ŒKubernetes æ²’æœ‰æä¾›åŸç”Ÿçš„é€™ç¨® Network Load Balancersï¼Œå¦‚æœè¦è®“å¤–éƒ¨ä½¿ç”¨è€…èƒ½é€£ç·šåˆ° bare metal cluster å…§éƒ¨çš„æœå‹™æ™‚ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ NodePort å’Œ ExternalIPs serviceï¼Œä½†é€™å…©ç¨®åœ¨ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨éƒ½æœ‰è‘—ç¼ºé»ã€‚\u003c/p\u003e\n\u003cp\u003eMetalLB çš„ç›®çš„å°±æ˜¯èˆ‡æ¨™æº–ç¶²è·¯è¨­å‚™åšæ•´åˆï¼Œä½¿ç”¨æ¨™æº–çš„è·¯ç”±å”å®šä½¿åœ¨ bare-metal clusters å…§çš„ \u003ccode\u003eå°å¤–éƒ¨çš„æœå‹™\u003c/code\u003e å¯ä»¥æ­£å¸¸é‹ä½œã€‚\u003c/p\u003e\n\u003cp\u003eMetalLB æä¾›å…©ç¨®æ¨¡å¼ï¼šBGP mode å’Œ Layer 2 modeï¼ŒBGP mode æ‰èƒ½å¯¦ç¾çœŸæ­£çš„è·¨å¤šç¯€é»å‡è¡¡è² è¼‰ï¼Œä½†å› ç‚ºæˆ‘åªæ˜¯æ¸¬è©¦ç”¨é€”æ‰€ä»¥æ¡ç”¨ Layer 2 modeã€‚\u003c/p\u003e\n\u003ch2 id=\"metallb-åœ¨åšä»€éº¼\"\u003eMetalLB åœ¨åšä»€éº¼\u003c/h2\u003e\n\u003cp\u003eMetalLB æœƒåŒæ™‚ä½œåˆ°å…©å€‹åŠŸèƒ½å»æä¾›æ­¤æœå‹™ï¼šIP ä½å€åˆ†é…ã€å‘å¤–éƒ¨å®£å‘Š IP æ˜¯å­˜åœ¨æ–¼é€™å€‹ clusterã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIP ä½å€åˆ†é…ï¼šä½ éœ€è¦æä¾› IP Pools çµ¦ MetalLBï¼Œå…¶é¤˜çš„äº‹ä¾‹å¦‚åˆ†é…ã€å–æ¶ˆåˆ†é…ã€è¿½è¹¤éƒ½ç”± MetalLB è™•ç†ã€‚Private/Public çš„ IPV4/IPV6 ä½ è¦ç¨ç«‹æä¾›æˆ–æ˜¯ä¸€èµ·æä¾›éƒ½å¯ä»¥ï¼Œå–æ±ºæ–¼ä½ çš„ç’°å¢ƒå’Œç§Ÿç”¨çš„ IPs\u003c/li\u003e\n\u003cli\u003eå‘å¤–éƒ¨å®£å‘Š IPï¼šå‘ cluster æ‰€åœ¨çš„ç¶²è·¯å®£å‘Šï¼Œé€™å€‹ IP å­˜åœ¨æˆ‘é€™å€‹ clusterï¼Œå®£å‘Šæ–¹å¼å–æ±ºæ–¼æ‰€ä½¿ç”¨çš„æ¨¡å¼ç‚ºä½•ï¼šARPã€NDPã€or BGP\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"é—œæ–¼-layer-2-æ¨¡å¼\"\u003eé—œæ–¼ Layer 2 æ¨¡å¼\u003c/h2\u003e\n\u003cp\u003eåœ¨ Layer 2 æ¨¡å¼ä¸‹ï¼Œæ˜¯ä¸€å€‹ç¯€é»è² è²¬å‘æœ¬åœ°ç¶²è·¯å®£å‘ŠæŸå€‹ Service IPï¼Œæ•…æ‰€æœ‰æµåˆ°æ­¤ Service IP çš„æµé‡éƒ½å…ˆç¶“éé€™å°ç¯€é»ï¼Œä¹‹å¾Œæ‰ç”± \u003ccode\u003ekube-proxy\u003c/code\u003e å»åˆ†æ•£æµé‡åˆ°æ­¤ Service çš„æ‰€æœ‰ Podsã€‚æ•… Layer 2 æ¨¡å¼æœªå¯¦ç¾çœŸæ­£çš„ç¶²è·¯è² è¼‰å¹³è¡¡ï¼Œè€Œæ˜¯å¯¦ç¾æ•…éšœè½‰ç§»çš„åŠŸèƒ½ï¼Œæ•…éšœè½‰ç§»çš„åµæ¸¬æ˜¯ä½¿ç”¨ \u003ca href=\"https://github.com/hashicorp/memberlist\"\u003ememberlist\u003c/a\u003e å¯¦ç¾ã€‚\u003c/p\u003e","title":"ğŸŒ Kubernetes å¤–éƒ¨å­˜å–ï¼šMetalLB è£¸æ©Ÿå®‰è£èˆ‡é€£ç·šæ¸¬è©¦"},{"content":" âš ï¸ åƒ…ç”¨æ–¼æ¸¬è©¦ç”¨é€”\nå®‰è£ é€é Helm å®‰è£ cert-managerï¼Œé¦–å…ˆä¸‹è¼‰ç°½ç½² cert-manager chart çš„ GPG keyringï¼Œä¸”åœ¨å®‰è£æ™‚ç”¨æ­¤ GPG keyring ä¾†é©—è­‰æˆ‘å€‘å¾ OCI Registry ä¸‹è¼‰çš„ chart\ncurl -LO https://cert-manager.io/public-keys/cert-manager-keyring-2021-09-20-1020CF3C033D4F35BAE1C19E1226061C665DF13E.gpg helm install \\ cert-manager oci://quay.io/jetstack/charts/cert-manager \\ --version v1.19.1 \\ --namespace cert-manager \\ --create-namespace \\ --verify \\ --keyring ./cert-manager-keyring-2021-09-20-1020CF3C033D4F35BAE1C19E1226061C665DF13E.gpg \\ --set crds.enabled=true ç”¢ç”Ÿ Private CA å°æ‡‰çš„ Custom Resources ä»¥ä¸‹ç‚ºç¯„ä¾‹çš„ manifest æª”æ¡ˆï¼Œå‘½åç‚º root_ca.yaml\napiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: selfsigned-issuer spec: selfSigned: {} --- apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: my-selfsigned-ca namespace: cert-manager spec: isCA: true commonName: my-selfsigned-ca secretName: root-secret privateKey: algorithm: ECDSA size: 256 issuerRef: name: selfsigned-issuer kind: ClusterIssuer group: cert-manager.io subject: organizations: - WCYa Example Inc. countries: - TW organizationalUnits: - Internal PKI localities: - Taipei --- apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: my-ca-issuer spec: ca: # `ClusterIssuer` resource is not namespaced, so `secretName` is assumed to reference secret in `cert-manager` namespace. secretName: root-secret é€™äº› Custom Resources çš„ç”¨é€”ï¼š\nselfsigned-issuer (ClusterIssuer)ï¼šç”¨ä¾†å¼•å° cert-manager è¦ä½¿ç”¨æœ¬åœ°çš„ PKIï¼Œè®“ç”¢ç”Ÿ my-selfsigned-ca (Certificate) æ™‚åƒç…§é€™å€‹ Issuer è¡¨ç¤ºè¦è‡ªè¡Œç°½ç½²æ†‘è­‰ my-selfsigned-ca (Certificate)ï¼šç”¢ç”Ÿ Private CAï¼Œkeypair æœƒè¢«å­˜åœ¨ Secret root-secret å¦‚æœ spec.subject æœªå¡«å¯«ï¼Œç”¢ç”Ÿçš„æ†‘è­‰å°±ä¸æœƒåŒ…å« subject DNï¼Œå¾æ¨™æº–ä¸Šä¾†çœ‹æ­¤æ†‘è­‰æ˜¯ç„¡æ•ˆçš„ï¼Œä½†æ¸¬è©¦ç”¨é€”çš„è©±å¯ä¸å¿…å¡«å¯«ï¼Œæ›´æº–ç¢ºçš„æè¿°å¯åƒè€ƒå®˜ç¶² Certificate Validity my-ca-issuer (ClusterIssuer)ï¼šå¾ŒçºŒç”¨ä¾†ç°½ç½² Leaf Certificate (æ‡‰ç”¨ç¨‹å¼æˆ–ä½¿ç”¨è€…å¯¦éš›ä½¿ç”¨çš„æ†‘è­‰) çš„ Issuerï¼Œç°½ç½²æ†‘è­‰æ™‚ä½¿ç”¨çš„æ˜¯ä¸Šè¿° my-selfsigned-ca ç”¢ç”Ÿçš„ Private CA å»ºç«‹ Resource Objectsï¼š\nkubectl apply -f root_ca.yaml å¾ Secret æŸ¥çœ‹ CA æ†‘è­‰ï¼š\nkubectl -n cert-manager get secret root-secret -o jsonpath=\u0026#34;{.data.ca\\.crt}\u0026#34; | base64 -d | openssl x509 -noout -text ","permalink":"https://wcya.github.io/hugo-papermod-blog/posts/kubernetes/cert-manager/","summary":"\u003cblockquote\u003e\n\u003cp\u003eâš ï¸ åƒ…ç”¨æ–¼æ¸¬è©¦ç”¨é€”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"å®‰è£\"\u003eå®‰è£\u003c/h2\u003e\n\u003cp\u003eé€é Helm å®‰è£ cert-managerï¼Œé¦–å…ˆä¸‹è¼‰ç°½ç½² cert-manager chart çš„ GPG keyringï¼Œä¸”åœ¨å®‰è£æ™‚ç”¨æ­¤ GPG keyring ä¾†é©—è­‰æˆ‘å€‘å¾ OCI Registry ä¸‹è¼‰çš„ chart\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -LO https://cert-manager.io/public-keys/cert-manager-keyring-2021-09-20-1020CF3C033D4F35BAE1C19E1226061C665DF13E.gpg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm install \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  cert-manager oci://quay.io/jetstack/charts/cert-manager \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --version v1.19.1 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --namespace cert-manager \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --create-namespace \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --verify \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --keyring ./cert-manager-keyring-2021-09-20-1020CF3C033D4F35BAE1C19E1226061C665DF13E.gpg \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --set crds.enabled\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ç”¢ç”Ÿ-private-ca-å°æ‡‰çš„-custom-resources\"\u003eç”¢ç”Ÿ Private CA å°æ‡‰çš„ Custom Resources\u003c/h2\u003e\n\u003cp\u003eä»¥ä¸‹ç‚ºç¯„ä¾‹çš„ manifest æª”æ¡ˆï¼Œå‘½åç‚º \u003ccode\u003eroot_ca.yaml\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecert-manager.io/v1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eClusterIssuer\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eselfsigned-issuer\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eselfSigned\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e{}\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecert-manager.io/v1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCertificate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emy-selfsigned-ca\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecert-manager\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eisCA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ecommonName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emy-selfsigned-ca\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esecretName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eroot-secret\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eprivateKey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ealgorithm\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eECDSA\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eissuerRef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eselfsigned-issuer\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eClusterIssuer\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecert-manager.io\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eorganizations\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eWCYa Example Inc.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ecountries\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eTW\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eorganizationalUnits\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eInternal PKI\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003elocalities\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eTaipei\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecert-manager.io/v1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eClusterIssuer\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emy-ca-issuer\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eca\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c\"\u003e# `ClusterIssuer` resource is not namespaced, so `secretName` is assumed to reference secret in `cert-manager` namespace.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003esecretName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eroot-secret\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eé€™äº› Custom Resources çš„ç”¨é€”ï¼š\u003c/strong\u003e\u003c/p\u003e","title":"ğŸ” Kubernetes ä¸­å®‰è£ cert-manager ä¸¦ç”¢ç”Ÿ Private CA"},{"content":"è¨»å†Š Disqus å¸³è™Ÿä¸¦å»ºç«‹ Site è‡³ disqus.com é»å³ä¸Šè§’ Sign up ä¸¦é¸æ“‡ Publishers ä¹‹å¾Œå»ºç«‹ä¸€å€‹ New Siteï¼Œé¡åˆ¥å¯éš¨æ„ å¹³å°é»é¸æœ€ä¸‹é¢çš„ I don't see my platform listed, install manually with Universal Code æŒ‰éˆ•ï¼Œå®‰è£æ­¥é©Ÿå¯å…ˆç•¥éï¼Œä¹‹å¾Œé‚„æ˜¯å¯ä»¥èª¿æ•´å¹³å°è·ŸæŸ¥çœ‹ Installation å–å¾— Shortnameï¼Œæ­¤å€¼ä¹‹å¾Œæœƒè²¼åˆ° Hugo çš„ config.yml è£¡ PaperMod å•Ÿç”¨ comments åŠŸèƒ½ ç›¸é—œ Feature è¨­å®šå¯åƒè€ƒ PaperMod çš„ exampleSiteï¼Œå’Œ Hugo comments æ–‡ä»¶\nåŠ å…¥ä»¥ä¸‹è¨­å®šåˆ° Hugo çš„ config.yml # å•Ÿç”¨ comments åŠŸèƒ½ params: comments: true # è¨­å®š Disqus Shortname services: disqus: shortname: \u0026#34;\u0026lt;ä½ å‰›å‰›å¾ Disqus è¤‡è£½çš„ Shortname\u0026gt;\u0026#34; å›  Hugo å·²é™„å¸¶ Disqus çš„æ¨¡æ¿ï¼Œæ‰€ä»¥å¯ç›´æ¥å°‡ä»¥ä¸‹å…§å®¹è²¼åˆ° layouts/partials/comments.html å¦‚ç›®éŒ„è·Ÿæª”æ¡ˆä¸å­˜åœ¨å¯è‡ªè¡Œå»ºç«‹ å¦‚éœ€è¦ override Hugo æ¨¡æ¿ï¼Œåƒè€ƒ å®˜æ–¹æ–‡ä»¶ {{ partial \u0026#34;disqus.html\u0026#34; . }} ","permalink":"https://wcya.github.io/hugo-papermod-blog/posts/hugo/papermod/comments-disqus/","summary":"\u003ch2 id=\"è¨»å†Š-disqus-å¸³è™Ÿä¸¦å»ºç«‹-site\"\u003eè¨»å†Š Disqus å¸³è™Ÿä¸¦å»ºç«‹ Site\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eè‡³ \u003ca href=\"https://disqus.com/\"\u003edisqus.com\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eé»å³ä¸Šè§’ \u003ccode\u003eSign up\u003c/code\u003e ä¸¦é¸æ“‡ \u003ccode\u003ePublishers\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eä¹‹å¾Œå»ºç«‹ä¸€å€‹ \u003ca href=\"https://disqus.com/admin/create/\"\u003eNew Site\u003c/a\u003eï¼Œé¡åˆ¥å¯éš¨æ„\u003c/li\u003e\n\u003cli\u003eå¹³å°é»é¸æœ€ä¸‹é¢çš„ \u003ccode\u003eI don't see my platform listed, install manually with Universal Code\u003c/code\u003e æŒ‰éˆ•ï¼Œå®‰è£æ­¥é©Ÿå¯å…ˆç•¥éï¼Œä¹‹å¾Œé‚„æ˜¯å¯ä»¥èª¿æ•´å¹³å°è·ŸæŸ¥çœ‹ Installation\u003c/li\u003e\n\u003cli\u003eå–å¾— \u003ccode\u003eShortname\u003c/code\u003eï¼Œæ­¤å€¼ä¹‹å¾Œæœƒè²¼åˆ° Hugo çš„ \u003ccode\u003econfig.yml\u003c/code\u003e è£¡\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"papermod-å•Ÿç”¨-comments-åŠŸèƒ½\"\u003ePaperMod å•Ÿç”¨ comments åŠŸèƒ½\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eç›¸é—œ Feature è¨­å®šå¯åƒè€ƒ PaperMod çš„ \u003ca href=\"https://adityatelange.github.io/hugo-PaperMod/posts/papermod/papermod-features/#comments\"\u003eexampleSite\u003c/a\u003eï¼Œå’Œ Hugo \u003ca href=\"https://gohugo.io/content-management/comments/\"\u003ecomments\u003c/a\u003e æ–‡ä»¶\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003col\u003e\n\u003cli\u003eåŠ å…¥ä»¥ä¸‹è¨­å®šåˆ° Hugo çš„ \u003ccode\u003econfig.yml\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# å•Ÿç”¨ comments åŠŸèƒ½\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ecomments\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# è¨­å®š Disqus Shortname\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eservices\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edisqus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eshortname\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;ä½ å‰›å‰›å¾ Disqus è¤‡è£½çš„ Shortname\u0026gt;\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003eå›  Hugo å·²é™„å¸¶ Disqus çš„æ¨¡æ¿ï¼Œæ‰€ä»¥å¯ç›´æ¥å°‡ä»¥ä¸‹å…§å®¹è²¼åˆ° \u003ccode\u003elayouts/partials/comments.html\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eå¦‚ç›®éŒ„è·Ÿæª”æ¡ˆä¸å­˜åœ¨å¯è‡ªè¡Œå»ºç«‹\u003c/li\u003e\n\u003cli\u003eå¦‚éœ€è¦ override Hugo æ¨¡æ¿ï¼Œåƒè€ƒ \u003ca href=\"https://gohugo.io/templates/embedded/#disqus\"\u003eå®˜æ–¹æ–‡ä»¶\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ partial \u0026#34;disqus.html\u0026#34; . }}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"ğŸ’¡ Hugo PaperMod å¦‚ä½•ä½¿ç”¨ Disqus å•Ÿç”¨ comments åŠŸèƒ½"},{"content":"é€™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡ Hugo + PaperMod çš„æ–‡ç«  ğŸ‰\n","permalink":"https://wcya.github.io/hugo-papermod-blog/posts/hello-world/","summary":"\u003cp\u003eé€™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡ Hugo + PaperMod çš„æ–‡ç«  ğŸ‰\u003c/p\u003e","title":"ï¸Šï¸ï¸Šï¸ï¸ï¸ï¸â˜„ï¸ Hello World"}]